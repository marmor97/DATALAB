---
title: "Relations between gender, activity level and network size"
author: "Marie"
date: "3/20/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Creating the dataframe from danish
```{r}
library(pacman)
p_load(readr, tidyverse, ggplot2, readxl)
danish <- read_excel("Danish_data.xlsx")

danish_p_gender <- danish %>% 
  select(group_id, 
         group_name, 
         privacy,
         female, 
         male, 
         unidentified,
         `total_unique_P+C`,
         `total_unique_user_id_post`,
         `total_unique_user_id_comment`,
         post_total,
         comment_total
        )

danish_p_gender <- danish_p_gender %>% 
  mutate(post_comment_total = post_total + comment_total)

danish_p_gender <- danish_p_gender %>% 
  mutate(m_f_total = (female + male))

danish_p_gender <- danish_p_gender %>% 
  mutate(m_perc = male/m_f_total) %>% 
  mutate(f_perc = female/m_f_total)

#removing groups there are only unidentified and no females/males
danish_p_gender <- danish_p_gender[complete.cases(danish_p_gender), ]

topic <- read_csv("prominant_topic_50.csv") %>% select(`0`)
#extracting numbers from the group name
regexp <- "[[:digit:]]+"
topic$`0` <- str_extract(topic$`0`, regexp)
#changing the group name
names(topic)[1] <- "group_id"

#merge to get the groups that are used
danish_p_gender <- merge(topic, danish_p_gender)
danish_p_gender$total_unique_P_C <- danish_p_gender$`total_unique_P+C`
```


Loop to binarize gender
```{r}
#Creating an empty column
danish_p_gender$dominance <- c(0)

for (i in (1:nrow(danish_p_gender))) {
  if (danish_p_gender$m_perc[i] > 0.70){
    danish_p_gender$dominance[i] <- 1 #for groups where there are more than 70% men write 1 (male dominant) 
    }
  if (danish_p_gender$f_perc[i] > 0.70){
    danish_p_gender$dominance[i] <- 2 #for groups where there are more than 70% women write 2 (female dominant) 
    }
}
```

Creating quantiles for network and activity
```{r}
#way to apply the quantiles
p_load(Hmisc)
danish_p_gender$network <- as.numeric(cut2(danish_p_gender$total_unique_P_C, g=10))
danish_p_gender$activity <- as.numeric(cut2(danish_p_gender$post_comment_total, g=10))

#manually changing the quantiles
table(danish_p_gender$network)

for (i in (1:nrow(danish_p_gender[1:6712,]))) {
  if (danish_p_gender$total_unique_P_C[i] == 4){
    danish_p_gender$network[i] <- 2  
  } 
}
#7299

which(danish_p_gender$total_unique_P_C == 4, arr.ind = T)
```

Gender
Plots network
```{r}
##NETWORK
network_gender <- danish_p_gender %>% #making a df for privacy size with dominance type
  group_by(dominance, network) %>% 
  summarise(n = n(), percentage = round((n/length(danish_p_gender$network)*100), digits = 3))

network_gender$dominance <- as.factor(network_gender$dominance)
network_gender$network <- as.factor(network_gender$network)

#defining colors used
suppressWarnings(require(RColorBrewer))
myColors <- brewer.pal(3, "Set1")

#plots
g_network <- ggplot(data = network_gender, aes(x = network, y = percentage, fill = factor(dominance)))

g_network + geom_bar(stat = "identity",width=0.9) + scale_fill_brewer(palette="Paired") + xlab("Network size") + ylab("%") + labs(fill = "Group") + labs(title = "Network size and gender") + labs(caption = "Group: 0 = equally dominant, 1 = male dominant, 2 = female dominant ") + geom_text(aes(label = n), position = position_stack(vjust = 0.8))

```

Plots activity
```{r}

##ACTIVITY
actvity_gender <- danish_p_gender %>% #making a df for privacy size with dominance type
  group_by(dominance, activity) %>% 
  summarise(n = n(), percentage = round((n/length(danish_p_gender$activity)*100), digits = 3))


actvity_gender$dominance <- as.factor(actvity_gender$dominance)
actvity_gender$activity <- as.factor(actvity_gender$activity)

#defining colors used
suppressWarnings(require(RColorBrewer))
myColors <- brewer.pal(3, "Set1")

#plots
g_activity <- ggplot(data = actvity_gender, aes(x = activity, y = percentage, fill = factor(dominance)))
g_activity + geom_bar(stat = "identity",width=0.9) + scale_fill_brewer(palette="Paired") + xlab("Actvity size") + ylab("%") + labs(fill = "Group") + labs(title = "Activity size and gender") + labs(caption = "Group: 0 = equally dominant, 1 = male dominant, 2 = female dominant ") + geom_text(aes(label = n), position = position_stack(vjust = 0.8))
```

Privacy
Plots network
```{r}
##NETWORK

network_privacy <- danish_p_gender %>% #making a df for privacy size with dominance type
  group_by(privacy, network) %>% 
  summarise(n = n(), percentage = round((n/length(danish_p_gender$network)*100), digits = 3))

network_privacy$privacy <- as.factor(network_gender$dominance)

network_privacy$network <- as.factor(network_gender$network)

network_privacy

#defining colors used
suppressWarnings(require(RColorBrewer))
myColors <- brewer.pal(3, "Set1")

#plots
network_private <- ggplot(data = network_privacy, aes(x = network, y = percentage, fill = factor(privacy)))
network_private + geom_bar(stat = "identity",width=0.9) + scale_fill_brewer(palette="Paired") + xlab("Network size") + ylab("%") + labs(fill = "Group") + labs(title = "Network size and privacy") + geom_text(aes(label = n), position = position_stack(vjust = 0.8))



```
Plots activity
```{r}
##ACTIVITY
actvity_privacy <- danish_p_gender %>% #making a df for privacy size with dominance type
  group_by(activity, privacy) %>% 
  summarise(n = n(), percentage = round((n/length(danish_p_gender$activity)*100), digits = 3))

actvity_privacy$privacy <- as.factor(actvity_privacy$privacy)
actvity_privacy$activity <- as.factor(actvity_privacy$activity)

#defining colors used
suppressWarnings(require(RColorBrewer))
myColors <- brewer.pal(3, "Set1")

#plots
acitvity_privacy <- ggplot(data = actvity_privacy, aes(x = activity, y = percentage, fill = factor(privacy)))
acitvity_privacy + geom_bar(stat = "identity",width=0.9) + scale_fill_brewer(palette="Paired") + xlab("Actvity size") + ylab("%") + labs(fill = "Group") + labs(title = "Activity size and privacy") + geom_text(aes(label = n), position = position_stack(vjust = 0.8))
```

Correlations
network-gender
- now i'm filtering only male and female dominant groups  
```{r}
#contingency table
male_female <- filter(danish_p_gender, dominance == 1 | dominance == 2)
gen_net <- table(male_female$dominance, male_female$network)
gen_net

#marginal frequencies
margin.table(gen_net, 1)#row frequencies - n of men and women
margin.table(gen_net, 2)#column marginal frequencies - n of people in each group

#proportion of people in each cell
round(prop.table(gen_net), 2) #cell

#relative interest - if there are unbalanced marginal inferences
round(prop.table(gen_net, 1), 2) #row - add up going across (12% of woman)
#13% of the woman are in 9 - activity 
#17% of men in netwrk level 0 (14s% for woman)

#finally, other drection (according to columns)
round(prop.table(gen_net, 2), 2) #column
#for level 9 - 52% were woman
```
activity-gender
```{r}
#contingency table
gen_activity <- table(male_female$dominance, male_female$activity)
gen_activity

testing_quantile <- table(danish_p_gender$dominance, danish_p_gender$activity)

sum(testing_quantile[,1])
sum(testing_quantile[,2])
sum(testing_quantile[,3])
sum(testing_quantile[,4])
sum(testing_quantile[,5])
sum(testing_quantile[,6])
sum(testing_quantile[,7])
sum(testing_quantile[,8])
sum(testing_quantile[,9])
sum(testing_quantile[,10])

#marginal frequencies
margin.table(gen_activity, 1)#row frequencies - n of men and women

margin.table(gen_activity, 2)#column marginal frequencies - n of people in each group

#proportion of people in each cell
round(prop.table(gen_activity), 2) #cell

#relative interest - if there are unbalanced marginal inferences
round(prop.table(gen_activity, 1), 2) #row - add up going across (12% of woman)
#12% of the woman are in 9 - activity 
#16% of men in activity level 0 (11% for woman)
#men 11% in level 8

#finally, other drection (according to columns)
round(prop.table(gen_activity, 2), 2) #column
#for level 9 - 51% were woman
```
privacy-network
```{r}
#contingency table
private_net <- table(male_female$privacy, male_female$network)

#marginal frequencies
margin.table(private_net, 1)#row frequencies - n of men and women

margin.table(private_net, 2)#column marginal frequencies - n of people in each group

#proportion of people in each cell
round(prop.table(private_net), 2) #cell

#relative interest - if there are unbalanced marginal inferences
round(prop.table(private_net, 1), 2) #row - add up going across (12% of woman)
#13% of the woman are in 9 - activity 

#finally, other drection (according to columns)
round(prop.table(private_net, 2), 2) #column

#very equal
```
privacy-activty
```{r}
#contingency table
private_active <- table(male_female$privacy, male_female$activity)

#marginal frequencies
margin.table(private_active, 1)#row frequencies - n of men and women

margin.table(private_active, 2)#column marginal frequencies - n of people in each group

#proportion of people in each cell
round(prop.table(private_active), 2) #cell

#relative interest - if there are unbalanced marginal inferences
round(prop.table(private_active, 1), 2) #row - add up going across (12% of woman)

#finally, other drection (according to columns)
round(prop.table(private_active, 2), 2) #column

#very equal - actually same amount of groups are private in level 9 as well as level 1 almost
```

chi square test
```{r}
#network-gender
chisq.test(gen_net)
#value of chisq = 452.6, df = 18, pvalue = 3.554e-06
#prob value - less than .05 - the variation between men and woman are bigger than we would expect by chance - likely reliable differences.

chisq.test(gen_activity)
#value of chisq = 257.3, df = 18, pvalue = 1.163e-11
#prob value - less than .05 - the variation between men and woman are bigger than we would expect by chance - likely reliable differences.

chisq.test(private_net)
#value of chisq = 16.41, df = 18, pvalue = 0.06
chisq.test(private_active)
#value of chisq = 20.13, df = 18, pvalue = 0.124
```

correlation
```{r}
p_load(corrplot)

privacy_cor <- select(male_female,
                      privacy,
                      network,
                      activity,
                      dominance)

privacy_cor$privacy <- as.factor(privacy_cor$privacy)
privacy_cor$privacy <- relevel(privacy_cor$privacy, ref = "OPEN", "CLOSED", "SECRET")
privacy_cor$privacy <- as.numeric(privacy_cor$privacy)
relevel(privacy_cor$privacy)
cor <- cor(privacy_cor)

corrplot(cor, method = "color", order ="hclust")
```

Relations between two 10% groups
```{r}
nrow(filter(danish_p_gender, network == 10 & activity_post== 10))/nrow(filter(danish_p_gender, activity_post == 10))*100
nrow(filter(danish_p_gender, network == 10 & activity_post == 10))/nrow(filter(danish_p_gender, network == 10))*100

```

Removing comment
```{r}
#repeating steps with comment 
danish_p_gender$activity_post <- as.numeric(cut2(danish_p_gender$post_total, g=10))

activity_post_gender <- danish_p_gender %>% #making a df for privacy size with dominance type
  group_by(dominance, activity_post) %>% 
  summarise(n = n(), percentage = round((n/length(danish_p_gender$activity_post)*100), digits = 3))

activity_post_gender$dominance <- as.factor(activity_post_gender$dominance)
activity_post_gender$activity_post <- as.factor(activity_post_gender$activity_post)

#plots
g_activity <- ggplot(data = activity_post_gender, aes(x = activity_post, y = percentage, fill = factor(dominance)))
g_activity + geom_bar(stat = "identity",width=0.9) + scale_fill_brewer(palette="Paired") + xlab("Actvity size") + ylab("%") + labs(fill = "Group") + labs(title = "Activity size and gender - comment") + labs(caption = "Group: 0 = equally dominant, 1 = male dominant, 2 = female dominant ") + geom_text(aes(label = n), position = position_stack(vjust = 0.8))
```


Last 10% against 90%
```{r}
ten_versus_nienty <- danish_p_gender
ten_versus_nienty$ten_perc_activity_post <- ifelse(ten_versus_nienty$activity_post == 10, 1, 0)
ten_versus_nienty$ten_perc_activity_comment <- ifelse(ten_versus_nienty$activity_comment == 10, 1, 0)
ten_versus_nienty$ten_perc_network <- ifelse(ten_versus_nienty$network == 10, 1, 0)

  
  
```

